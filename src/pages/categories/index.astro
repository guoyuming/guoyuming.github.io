---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

const posts = await getCollection('posts');

// Group posts by category
const postsByCategory = posts.reduce((acc, post) => {
  const category = post.data.category;
  if (!acc[category]) acc[category] = [];
  acc[category].push(post);
  return acc;
}, {} as Record<string, typeof posts>);

const categories = Object.keys(postsByCategory).sort();

// Category theme colors for visual distinction
const categoryColors: Record<string, { bg: string; border: string }> = {
  'essays': { bg: '#fef4ec', border: '#e8d4c4' },
  'making': { bg: '#e8f4f0', border: '#c4d8d0' },
  '具身认知': { bg: '#eef0ff', border: '#c4c8e8' },
  'reading': { bg: '#f5f0f8', border: '#d8c8e0' }
};

const getColors = (cat: string) => categoryColors[cat] || { bg: '#f8f8f8', border: '#e0e0e0' };
---

<BaseLayout title="分类">
  <div class="categories-container">
    <h1 class="page-title">分类</h1>
    <p class="page-subtitle">共 {categories.length} 个分类</p>
    
    <div class="category-grid">
      {categories.map(category => {
        const colors = getColors(category);
        return (
          <a 
            href={`/categories/${category}`} 
            class="category-card"
            style={`--card-bg: ${colors.bg}; --card-border: ${colors.border};`}
          >
            <span class="category-count">{postsByCategory[category].length}</span>
            <span class="category-name">{category}</span>
            <span class="category-label">篇文章</span>
          </a>
        );
      })}
    </div>
  </div>
</BaseLayout>

<style>
  .categories-container {
    max-width: 900px;
    margin: 0 auto;
  }

  .category-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
  }

  .category-card {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 40px 24px;
    background: var(--card-bg);
    border: 1px solid var(--card-border);
    border-radius: 20px;
    text-align: center;
    border-bottom: 1px solid var(--card-border);
    transition: all 0.2s ease;
  }

  .category-card:hover {
    transform: scale(1.03);
    box-shadow: 0 8px 30px rgba(45, 32, 17, 0.1);
    border-bottom: 1px solid var(--card-border);
  }

  .category-count {
    font-family: var(--font-display);
    font-size: 4rem;
    font-weight: 400;
    line-height: 1;
    opacity: 0.3;
    margin-bottom: 8px;
  }

  .category-name {
    font-family: var(--font-heading);
    font-size: 1.25rem;
    font-weight: 700;
    margin-bottom: 4px;
  }

  .category-label {
    font-size: 0.875rem;
    color: var(--color-text-muted);
  }

  @media (max-width: 480px) {
    .category-grid {
      grid-template-columns: 1fr;
    }

    .category-card {
      padding: 32px 20px;
    }

    .category-count {
      font-size: 3rem;
    }
  }
</style>

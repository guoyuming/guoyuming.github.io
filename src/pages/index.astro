---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

const posts = await getCollection('posts');
const sortedPosts = posts.sort((a, b) => 
  a.data.title.localeCompare(b.data.title, 'zh-CN')
);

// Get first ~80 characters of content for excerpt (simplified approach)
const getExcerpt = (body: string, maxLength = 100) => {
  // Remove markdown formatting and get plain text
  const plainText = body
    .replace(/^---[\s\S]*?---/, '') // Remove frontmatter
    .replace(/[#*_`>\[\]]/g, '') // Remove markdown symbols
    .replace(/\n+/g, ' ') // Replace newlines with spaces
    .trim();
  
  if (plainText.length <= maxLength) return plainText;
  return plainText.substring(0, maxLength).trim() + '...';
};
---

<BaseLayout title="首页">
  <ul class="post-grid">
    {sortedPosts.map((post, index) => (
      <li class="post-card">
        <a href={`/posts/${post.slug}`} class="post-card-link">
          <div class="post-card-content">
            <h2 class="post-card-title">{post.data.title}</h2>
            <p class="post-card-excerpt">{getExcerpt(post.body)}</p>
          </div>
        </a>
      </li>
    ))}
  </ul>
</BaseLayout>
